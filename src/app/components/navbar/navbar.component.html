<nav class="navbar">
  <div class="navbar-container">
    <!-- Logo/Brand -->
    <div class="navbar-brand" (click)="scrollToTop()">
      <div class="logo-wrapper">
        <span class="logo-text">⚕️</span>
      </div>
      <span class="brand-text">ClinikDB</span>
    </div>

    <!-- Desktop Navigation -->
    <div class="desktop-nav">
      <button
        *ngFor="let item of navItems"
        class="nav-link"
        [class.active]="activeSection === item.section"
        (click)="scrollToSection(item.section)"
      >
        {{ item.labelKey }}
      </button>
    </div>

    <!-- CTA Section -->
    <div class="nav-actions">
      <ng-container *ngIf="user$ | async as user; else loggedOut">
        <div class="user-menu-wrapper" #userMenuContainer>
          <button
            class="user-chip"
            type="button"
            (click)="toggleUserMenu($event)"
            [attr.aria-expanded]="userMenuOpen"
            aria-haspopup="true"
          >
            <ng-container *ngIf="getUserPhoto(user) as photo; else initials">
              <img
                class="user-avatar"
                [src]="photo"
                referrerpolicy="no-referrer"
                [alt]="user.displayName || user.email || 'User avatar'"
              />
            </ng-container>
            <ng-template #initials>
              <div class="user-avatar placeholder">
                {{ getUserInitials(user) }}
              </div>
            </ng-template>
            <span class="user-name">
              {{ (appUser$ | async)?.displayName || user.displayName || user.email }}
            </span>
          </button>
          <div class="user-menu" *ngIf="userMenuOpen">
            <button
              class="user-menu-item"
              type="button"
              (click)="goToDashboard()"
              *ngIf="isAdmin$ | async"
            >
              Dashboard
            </button>
            <button class="user-menu-item" type="button" (click)="logout()">
              Sign out
            </button>
          </div>
        </div>
      </ng-container>
      <ng-template #loggedOut>
        <button class="demo-button" type="button" (click)="openLoginModal()">
          Log In
        </button>
      </ng-template>
      <button class="cta-button" type="button" (click)="scrollToSection('pricing')">
        Get Started
      </button>
      <button class="demo-button" type="button" (click)="goToDashboard()" *ngIf="isAdmin$ | async">
        Dashboard
      </button>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-toggle" (click)="toggleMobileMenu()">
      <span>☰</span>
    </button>
  </div>
</nav>

<!-- Login Modal -->
<div
  class="login-modal-backdrop"
  *ngIf="showLoginModal && !(user$ | async)"
  (click)="closeLoginModal()"
>
  <div class="login-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeLoginModal()">✕</button>
    <h2 class="modal-title">Log In</h2>
    <p class="modal-subtitle">Continue with your Google account</p>
    <button class="google-btn" (click)="loginWithGoogle()">
      <span class="google-icon">G</span>
      <span>Continue with Google</span>
    </button>
  </div>
</div>
