<section class="pricing-section" id="pricing">
  <div class="pricing-container">
    <!-- Header -->
    <div class="pricing-header">
      <h2 class="pricing-title">Medical Cabinet Solutions</h2>
      <p class="pricing-subtitle">Choose the plan that fits your medical practice's needs</p>
    </div>
    
    <!-- Promo Code Section -->
    <div class="promo-section">
      <mat-card class="promo-card">
        <div class="promo-header">
          <lucide-angular [img]="Gift" size="24" class="promo-icon"></lucide-angular>
          <h3 class="promo-title">Have a referral code?</h3>
        </div>
        
        <div *ngIf="!appliedPromoCode" class="promo-input-group">
          <mat-form-field appearance="outline" class="promo-field">
            <mat-label>Referral Code</mat-label>
            <input matInput [ngModel]="promoCode" (ngModelChange)="onPromoInput($event)" placeholder="e.g., ALICE20" (keyup.enter)="applyPromoCode()" autocomplete="off" aria-label="Referral code">
            <lucide-angular matSuffix [img]="Tag" size="20"></lucide-angular>
            <mat-hint>Enter the code provided by your referral agent</mat-hint>
          </mat-form-field>
          <button mat-raised-button color="primary" (click)="applyPromoCode()" class="apply-button" [disabled]="!promoCode">
            Apply Code
          </button>
        </div>
        
        <div *ngIf="appliedPromoCode" class="promo-applied">
          <div class="promo-applied-content">
            <lucide-angular [img]="CheckCircle" size="24" class="success-icon"></lucide-angular>
            <div class="promo-applied-text">
              <p class="promo-applied-title">Promo code applied!</p>
              <p class="promo-applied-code">{{ appliedPromoCode }} - {{ discountPercentage }}% discount</p>
            </div>
          </div>
          <button mat-icon-button (click)="removePromoCode()" class="remove-button">
            <lucide-angular [img]="X" size="20"></lucide-angular>
          </button>
        </div>
        
        <mat-divider class="promo-divider"></mat-divider>
        
        <div class="promo-info">
          <mat-icon class="info-icon">info_outline</mat-icon>
          <p class="info-text">Referral codes help you save and support healthcare professionals in our network</p>
        </div>
      </mat-card>
    </div>
    
    <!-- Pricing Cards -->
    <div class="pricing-grid">
      <mat-card 
        *ngFor="let plan of plans; trackBy: trackByPlan"
        class="pricing-card"
        [class.highlighted]="plan.highlighted"
        [class.has-gradient]="plan.gradient"
      >
        <!-- Badge -->
        <div *ngIf="plan.badge" class="plan-badge-container">
          <span class="plan-badge">{{ plan.badge }}</span>
        </div>
        
        <!-- Card Header with Icon -->
        <div class="card-header" [style.background]="plan.gradient">
          <div class="plan-icon-wrapper">
            <lucide-angular [img]="plan.icon" size="32" class="plan-icon"></lucide-angular>
          </div>
          <h3 class="plan-name">{{ plan.name }}</h3>
          <p class="plan-description">{{ plan.description }}</p>
        </div>
        
        <mat-card-content class="card-content">
          <!-- Pricing -->
          <div class="pricing-display">
            <div class="price-row">
              <span *ngIf="plan.price === 0" class="price-free">Free</span>
              <div *ngIf="plan.price > 0" class="price-container">
                <span class="currency">$</span>
                <span class="price-amount">{{ getDiscountedPrice(plan.price) }}</span>
                <span class="price-period">/{{ plan.period }}</span>
              </div>
            </div>
            <div *ngIf="plan.price > 0 && discountPercentage > 0" class="discount-info">
              <span class="original-price">${{ plan.price }}</span>
              <mat-chip class="savings-chip">
                Save ${{ plan.price - getDiscountedPrice(plan.price) }}
              </mat-chip>
            </div>
          </div>
          
          <mat-divider class="features-divider"></mat-divider>
          
          <!-- Features List -->
          <ul class="features-list">
            <li *ngFor="let feature of plan.features" class="feature-item">
              <lucide-angular [img]="CheckCircle" size="20" class="feature-icon"></lucide-angular>
              <span class="feature-text">{{ feature }}</span>
            </li>
          </ul>
          
          <!-- CTA Button -->
          <button 
            mat-raised-button 
            [color]="plan.highlighted ? 'primary' : ''"
            class="plan-button"
            [class.primary-button]="plan.highlighted"
            (click)="subscribe(plan)"
          >
            {{ plan.buttonText }}
          </button>
        </mat-card-content>
      </mat-card>
    </div>
    
    <!-- Footer Notes -->
    <div class="pricing-footer">
      <div class="enterprise-section">
        <mat-icon class="enterprise-icon">business</mat-icon>
        <div class="enterprise-content">
          <p class="enterprise-text">
            Need a custom solution for multiple locations?
          </p>
          <a href="#contact" class="enterprise-link">Contact our enterprise team â†’</a>
        </div>
      </div>
      
      <div class="features-note">
        <mat-icon>verified_user</mat-icon>
        <p>All plans include 24/7 support, regular updates, and HIPAA compliance</p>
      </div>
    </div>
    
    <!-- Referral Partner Info -->
    <div class="partner-info">
      <mat-card class="partner-card">
        <mat-card-content>
          <div class="partner-content">
            <div class="partner-icon-wrapper">
              <mat-icon class="partner-icon">handshake</mat-icon>
            </div>
            <div class="partner-text">
              <h4 class="partner-title">Referral Partner Program</h4>
              <p class="partner-description">
                When you use a referral code, your referring agent earns a commission for helping you discover our platform. 
                It's our way of thanking healthcare professionals who recommend MedCabinet Pro to their colleagues.
              </p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</section>
